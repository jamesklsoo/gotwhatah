<p id="notice"><%= notice %></p>
<h1>Got What Ah?</h1>
<h4>Locate your news anywhere you are</h4>
<br>
<h2>Events</h2>
<%= form_tag(events_path, :method => 'get', id: "search-form") do %>
  <%= text_field_tag :search, params[:search], placeholder: "Search events or area" %>
  <%= select_tag "category_search", options_for_select([["food", "food"], ["lifestyle","lifestyle"], ["entertainment","entertainment"]]), include_blank: true %>
  <%= submit_tag "Search", :name => nil %>
<% end %>
<% if @event_search.blank? %>
  <p>There are no events containing the term "<%= params[:search] %>".</p>
<% else %>
  <tr>
    <% @event_search.each do |t| %>
      <% u= User.find_by_id(t.user_id) %>
      <td><%= link_to u.username, user_path(t.user_id) %>(<%= u.status %>)</td>
      <td><%= link_to t.title, user_event_path(u.id, t.id) %></td>
      <td><%= t.category %></td>
      <td><%= current_user.distance_to(t.address).round(1) %> kilometres </td>
    </tr>
    <br>
  <% end %>
<% end %>
<table>
  <thead>
    <tr>
      <th>User</th>
      <th>Title</th>
      <th>Description</th>
      <th>Address</th>
      <th>Start date</th>
      <th>End date</th>
      <th>Category</th>
      <th>Likes</th>
      <th>Dislikes</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <% @events.each do |event| %>
      <tr>
        <% u= User.find_by_id(event.user_id) %>
        <td><%= u.username %></td>
        <td>
          <%= link_to "#{event.title}", user_event_path(event.user_id, event.id) %>
          <br>
          <% if !event.images.empty? %>
            <%= image_tag event.images[0].thumb %>
          <% end %>
        </td>
        <td><%= event.description %></td>
        <td><%= event.address %></td>
        <td><%= event.start_date %></td>
        <td><%= event.end_date %></td>
        <td><%= event.category %></td>
        <td>
          <%=link_to like_event_path(event), class: 'btn btn-default btn-sm', :id => "upvote-#{event.id}" , method: :put, remote: true do %>
            <span class="glyphicon glyphicon-chevron-up"></span>
            like <span class="votes-count" data-id="<%= event.id %>"><%=event.get_upvotes.size%></span>
          <% end %>
        </td>
        <td>
          <%=link_to dislike_event_path(event), class: 'btn btn-default btn-sm vote-button', :id => "downvote-#{event.id}", method: :put, remote: true do %>
            <span class="glyphicon glyphicon-chevron-down"></span>
            dislike<span class="votes-count" data-id="<%= event.id %>"> <%=event.get_downvotes.size%></span>
          <%end%>
        </td>
        <td><%= social_share_button_tag("#{event.title} #{event.description} #{event.address}") %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<br>
<h2>Events near you (within 30 kilometres)</h2>
<table>
  <thead>
    <tr>
      <th>User</th>
      <th>Title</th>
      <th>Category</th>
      <th>Distance from you</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <% Event.near(current_user.address, 30).each do |t| %>
        <% u= User.find_by_id(t.user_id) %>
        <td><%= link_to u.username, user_path(t.user_id) %>(<%= u.status %>)</td>
        <td><%= link_to t.title, user_event_path(u.id, t.id) %></td>
        <td><%= t.category %></td>
        <td><%= t.distance.round(1) %> kilometres</td>
      </tr>
    <% end %>
  </tbody>
</table>
<br>
<%= link_to 'New Event', new_user_event_path(current_user.id) %>
<%= button_to "Sign Out", sign_out_path, method: :delete %>